# KIỂM TRA GIỮA KỲ - LẬP TRÌNH WEB

**Họ và tên:** Nguyễn Nhật Huy  
**MSSV:** 23110226  
**Mã đề:** Đề số 12

---

## TỔNG QUAN DỰ ÁN

Dự án KiemTraQTWeb là một ứng dụng web quản lý sản phẩm và người dùng được xây dựng bằng Spring Boot 3.5.6, JSP, và SiteMesh 3.2.1.

### Công nghệ sử dụng:
- **Backend:** Spring Boot 3.5.6, Spring Data JPA
- **Frontend:** JSP, JSTL, SiteMesh 3.2.1
- **Database:** SQL Server
- **Security:** BCrypt Password Encoder
- **Build Tool:** Maven

---

## CẤU TRÚC DỰ ÁN

```
src/main/java/com/nhathuy/ktraqtweb/
├── config/
│   ├── AdminInterceptor_23110226.java       # Interceptor kiểm tra quyền Admin
│   ├── SitemeshConfig_23110226.java         # Cấu hình SiteMesh
│   └── WebMvcConfig_23110226.java           # Cấu hình Web MVC
├── controller/
│   ├── AdminController_23110226.java        # Controller quản trị
│   ├── AuthController_23110226.java         # Controller đăng nhập/đăng ký
│   ├── HomeController_23110226.java         # Controller trang chủ
│   └── ShopController_23110226.java         # Controller sản phẩm
├── entity/
│   ├── Users_23110226.java
│   ├── UserRoles_23110226.java
│   ├── Product_23110226.java
│   ├── Category_23110226.java
│   ├── Seller_23110226.java
│   ├── Cart_23110226.java
│   └── CartItem_23110226.java
├── repository/
│   ├── UserRepository_23110226.java
│   ├── UserRoleRepository_23110226.java
│   ├── ProductRepository_23110226.java
│   └── CategoryRepository_23110226.java
├── service/
│   ├── UserService_23110226.java
│   ├── ProductService_23110226.java
│   └── CategoryService_23110226.java
└── service/impl/
    ├── UserServiceImpl_23110226.java
    ├── ProductServiceImpl_23110226.java
    └── CategoryServiceImpl_23110226.java

src/main/webapp/WEB-INF/views/
├── home.jsp
├── login.jsp
├── register.jsp
├── product_list.jsp
├── product_detail.jsp
├── layout/
│   ├── user_decorator.jsp
│   └── admin_decorator.jsp
└── admin/
    ├── user_list.jsp
    ├── user_form.jsp
    ├── category_list.jsp
    └── category_form.jsp
```

---

## CHI TIẾT CÁC CHỨC NĂNG

### **Câu 1: Cấu hình SiteMesh (2.0 điểm) ✅**

**File:** `SitemeshConfig_23110226.java`

- Cấu hình SiteMesh Filter với Spring Boot
- Áp dụng decorator cho `/admin/*` → `admin_decorator.jsp`
- Áp dụng decorator cho `/*` → `user_decorator.jsp`
- Loại trừ các path: `/api/*`, `/resources/*`, `/static/*`

**Decorators:**
- `user_decorator.jsp`: Header màu xanh (#007bff), navigation cho user
- `admin_decorator.jsp`: Header màu đỏ (#dc3545), navigation cho admin với badge "ADMIN PANEL"

---

### **Câu 2: Đăng ký, Đăng nhập, Session (1.0 điểm) ✅**

**Controller:** `AuthController_23110226.java`

#### Đăng ký (`/register`)
- Form nhập: username, email, fullname, password, confirmPassword
- Mã hóa password bằng BCrypt
- Tự động gán roleId = 2 (USER)
- Kiểm tra username đã tồn tại

#### Đăng nhập (`/login`)
- Xác thực bằng BCrypt
- Lưu session: userId, username, fullname, roleName, roleId
- Redirect theo role:
  - ADMIN → `/admin/users`
  - USER → `/`

#### Đăng xuất (`/logout`)
- Hủy session
- Redirect về trang chủ

**Repository:** `UserRepository_23110226.java`
- Method: `findByUsername(String username)`

**Service:** `UserServiceImpl_23110226.java`
- `register()`: Đăng ký user mới với BCrypt
- `authenticate()`: Xác thực password với BCrypt

---

### **Câu 3: Hiển thị danh sách sản phẩm nhóm theo Seller (2.0 điểm) ✅**

**Controller:** `ShopController_23110226.java`
- Endpoint: `GET /products`

**Service:** `ProductServiceImpl_23110226.java`
- Method: `findAllProductsGroupedBySeller()`
- Return: `Map<Seller_23110226, List<Product_23110226>>`
- Logic: Sử dụng Stream API để group products theo seller

**View:** `product_list.jsp`
- Hiển thị sản phẩm theo từng Seller
- Mỗi seller có section riêng với header màu xanh
- Grid layout responsive (auto-fill, minmax 250px)
- Thông tin hiển thị: Tên, Mã SP, Giá, Số lượng còn, Danh mục
- Tên sản phẩm là link đến trang chi tiết

---

### **Câu 4: Hiển thị chi tiết sản phẩm (2.0 điểm) ✅**

**Controller:** `ShopController_23110226.java`
- Endpoint: `GET /products/{productId}`

**Service:** `ProductServiceImpl_23110226.java`
- Method: `findById(Long id)`

**View:** `product_detail.jsp`
- Layout 2 cột: Hình ảnh | Thông tin
- Hiển thị đầy đủ:
  - Tên sản phẩm
  - Mã sản phẩm
  - Giá (format tiền tệ)
  - Số lượng & Còn lại
  - Danh mục
  - Người bán (Seller)
  - Ngày tạo
  - Trạng thái (Active/Inactive)
  - **Description** (full text, section riêng)

---

### **Câu 5: CRUD User và Category với Phân trang (3.0 điểm) ✅**

#### **Admin Interceptor**
**File:** `AdminInterceptor_23110226.java`
- Kiểm tra session tồn tại
- Kiểm tra roleName = "ADMIN"
- Áp dụng cho tất cả `/admin/**`
- Redirect về `/login` nếu chưa đăng nhập
- Redirect về `/` nếu không phải ADMIN

**Config:** `WebMvcConfig_23110226.java`
- Đăng ký interceptor cho pattern `/admin/**`

#### **CRUD User**

**Controller:** `AdminController_23110226.java`

**Endpoints:**
- `GET /admin/users?page=0&size=10` - Danh sách user có phân trang
- `GET /admin/users/new` - Form thêm user
- `GET /admin/users/edit/{id}` - Form sửa user
- `POST /admin/users/save` - Lưu user (thêm/sửa)
- `GET /admin/users/delete/{id}` - Xóa user

**Service:** `UserServiceImpl_23110226.java`
- `findAll(Pageable pageable)` - Hỗ trợ phân trang
- `save()` - Tự động mã hóa password nếu thay đổi
- `deleteById()`

**Views:**
- `user_list.jsp`: Table với pagination, hiển thị 10 users/trang
- `user_form.jsp`: Form thêm/sửa với dropdown chọn Role

#### **CRUD Category**

**Controller:** `AdminController_23110226.java`

**Endpoints:**
- `GET /admin/categories?page=0&size=10` - Danh sách category có phân trang
- `GET /admin/categories/new` - Form thêm category
- `GET /admin/categories/edit/{id}` - Form sửa category
- `POST /admin/categories/save` - Lưu category
- `GET /admin/categories/delete/{id}` - Xóa category

**Service:** `CategoryServiceImpl_23110226.java`
- `findAll(Pageable pageable)` - Hỗ trợ phân trang
- CRUD methods đầy đủ

**Views:**
- `category_list.jsp`: Table với pagination, hiển thị 10 categories/trang
- `category_form.jsp`: Form thêm/sửa category

---

## CẤU HÌNH DATABASE

**File:** `application.properties`

```properties
spring.datasource.url=jdbc:sqlserver://localhost:1433;databaseName=KiemTraQTWeb;encrypt=true;trustServerCertificate=true
spring.datasource.username=sa
spring.datasource.password=nhathuy
spring.datasource.driver-class-name=com.microsoft.sqlserver.jdbc.SQLServerDriver

spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.database-platform=org.hibernate.dialect.SQLServerDialect

spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp
```

---

## HƯỚNG DẪN CHẠY ỨNG DỤNG

### 1. Yêu cầu hệ thống:
- JDK 17+
- Maven 3.6+
- SQL Server
- IDE: IntelliJ IDEA / Eclipse

### 2. Cấu hình Database:
```sql
-- Tạo database
CREATE DATABASE KiemTraQTWeb;

-- Tạo bảng UserRoles
INSERT INTO UserRoles (roleName) VALUES ('ADMIN'), ('USER');
```

### 3. Chạy ứng dụng:
```bash
mvn clean install
mvn spring-boot:run
```

### 4. Truy cập:
- Trang chủ: http://localhost:8080/
- Đăng nhập: http://localhost:8080/login
- Đăng ký: http://localhost:8080/register
- Sản phẩm: http://localhost:8080/products
- Admin (cần đăng nhập ADMIN): http://localhost:8080/admin/users

---

## TÀI KHOẢN MẪU

Sau khi đăng ký, bạn có thể tạo tài khoản ADMIN bằng cách:
1. Đăng ký tài khoản mới qua `/register`
2. Vào database, update roleId = 1 cho user đó
3. Đăng nhập lại để truy cập Admin Panel

---

## ĐIỂM NỔI BẬT

### 1. **Architecture tốt:**
- Tuân thủ naming convention: `ClassName_23110226.java`
- Phân tách rõ ràng: Controller → Service → Repository
- Sử dụng Interface cho Service layer

### 2. **Security:**
- BCrypt password hashing
- Session-based authentication
- Admin Interceptor bảo vệ admin routes

### 3. **UI/UX:**
- Responsive design
- SiteMesh decorators cho layout nhất quán
- Navigation thông minh (hiển thị theo role)
- Pagination đầy đủ với First/Previous/Next/Last

### 4. **Code Quality:**
- Sử dụng Stream API cho group by logic
- Optional handling đúng cách
- Error handling với try-catch
- Confirmation dialog cho delete actions

---

## TESTING CHECKLIST

- [x] Câu 1: SiteMesh hoạt động, decorators hiển thị đúng
- [x] Câu 2: Đăng ký, đăng nhập, session, redirect theo role
- [x] Câu 3: Danh sách sản phẩm nhóm theo Seller
- [x] Câu 4: Chi tiết sản phẩm với description
- [x] Câu 5: CRUD User với phân trang
- [x] Câu 5: CRUD Category với phân trang
- [x] Câu 5: Admin Interceptor bảo vệ admin routes

---

## GHI CHÚ

- Tất cả password được mã hóa bằng BCrypt
- Session timeout mặc định của Spring Boot
- Pagination: 10 items/page
- SiteMesh 3.2.1 tương thích với Jakarta EE (Spring Boot 3.x)

---

**Ngày hoàn thành:** 30/09/2025  
**Sinh viên thực hiện:** Nguyễn Nhật Huy - 23110226
